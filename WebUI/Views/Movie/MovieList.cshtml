@model WebUI.Models.ViewModels.MovieListViewModel

@{
    ViewData["Title"] = "MovieList";
    Layout = "~/Views/UserUILayout/LayoutUI.cshtml"; // Layout yolunuzun doğru olduğundan emin olun

    // URL'deki mevcut filtreleri (genreIds) kaybetmemek için bir sözlük oluşturuyoruz.
    var routeData = new Dictionary<string, string>();
    var genreIds = Context.Request.Query["genreIds"];
    if (genreIds.Any())
    {
        foreach (var id in genreIds)
        {
            routeData.Add("genreIds", id);
        }
    }
    // Hangi Controller Action'ına gidileceğini belirliyoruz.
    var actionName = genreIds.Any() ? "GetMoviesByGenres" : "MovieList";
}

<div class="page-single movie_list">
    <div class="container">
        <div class="row ipad-width2">
            <div class="col-md-8 col-sm-12 col-xs-12">
                <div class="topbar-filter">
                    <p><span>@Model.TotalCount</span> film bulundu.</p>
                </div>

                @foreach (var i in Model.MoviesList)
                {
                    <div class="movie-item-style-2">
                        <img src="@(string.IsNullOrEmpty(i.Poster_path)
                                                             ? "https://via.placeholder.com/500x750?text=No+Image"
                                                             : $"https://image.tmdb.org/t/p/w500{i.Poster_path}")"
                         alt="@i.Title">
                    <div class="mv-item-infor">
                        <h6><a href="#">@i.Title <span>(@i.Release_date)</span></a></h6>
                        <p class="rate"><i class="ion-android-star"></i><span>@i.Vote_average</span> /10</p>
                        <p class="describe">@i.Overview</p>
                    </div>
                </div>
                                }

                <div class="topbar-filter">
                    <label>Her Sayfadaki Film Sayısı:</label>
                    <select onchange="changePageSize(this.value)">
                        <option value="5" selected="@(Model.PageSize == 5)">5 Film</option>
                        <option value="10" selected="@(Model.PageSize == 10)">10 Film</option>
                    </select>

                    <div class="pagination2">
                        <span>Sayfa @Model.CurrentPage / @Model.TotalPages</span>

                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            routeData["pageNumber"] = i.ToString();
                            routeData["pageSize"] = Model.PageSize.ToString();
                            <a class="@(i == Model.CurrentPage ? "active" : "")" asp-action="@actionName" asp-all-route-data="routeData">@i</a>
                        }

                        @if (Model.CurrentPage < Model.TotalPages)
                        {
                            routeData["pageNumber"] = (Model.CurrentPage + 1).ToString();
                            <a asp-action="@actionName" asp-all-route-data="routeData"><i class="ion-arrow-right-b"></i></a>
                        }
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-12 col-xs-12">
                <div class="sidebar">
                    @await Component.InvokeAsync("_UserUIMovieGenreListComponentsPartial")
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function changePageSize(pageSize) {
            const url = new URL(window.location.href);
            url.searchParams.set('pageSize', pageSize);
            url.searchParams.set('pageNumber', '1');
            window.location.href = url.toString();
        }
    </script>
}